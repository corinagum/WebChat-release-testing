<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>JS w/o React</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script crossorigin="anonymous" src="https://unpkg.com/babel-standalone@6/babel.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/regenerator-runtime@0.13.3/runtime.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/markdown-it/dist/markdown-it.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/whatwg-fetch"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/react@16.8.6/umd/react.development.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.development.js"></script>

    <link href="../common/cheatSheet.css" rel="stylesheet" />
    <link href="../common/markdown.css" rel="stylesheet" />
    <link href="../common/webchat.css" rel="stylesheet" />
    <script data-presets="es2015,stage-3" src="../common/createFetchTokens.js" type="text/babel"></script>
    <script data-presets="es2015,stage-3" src="../common/renderCheatSheet.js" type="text/babel"></script>

    <script src="../drops/webchat-es5.js"></script>
  </head>
  <body>
    <div id="webchat" role="main"></div>
    <script type="text/babel" data-presets="es2015,react,stage-3">
      const { fetchDirectLineToken, fetchSpeechServicesRegion, fetchSpeechServicesToken } = window.createFetchTokens();
      const {
        WebChat: { createCognitiveServicesSpeechServicesPonyfillFactory, createDirectLine, createStore, renderWebChat }
      } = window;

      async function main() {
        const directLine = createDirectLine({ token: await fetchDirectLineToken() });
        const store = window.webChatStore = createStore();

        // Create Web Speech ponyfill if the browser support WebRTC
        const webSpeechPonyfillFactory =
          window.navigator.mediaDevices &&
          (await createCognitiveServicesSpeechServicesPonyfillFactory({
            authorizationToken: fetchSpeechServicesToken,
            region: await fetchSpeechServicesRegion()
          }));

        // We want to make sure we didn't break React hooks in hosting apps
        const ActivityContainer = ({ children }) => {
          React.useEffect(() => {});

          return children;
        };

        renderWebChat(
          {
            activityMiddleware: () => next => card => children => (
              <ActivityContainer>{next(card)(children)}</ActivityContainer>
            ),
            directLine,
            // Firefox default language to "en", which is not supported by Cognitive Services, we need to specify it as "en-US"
            locale: 'en-US',
            store,
            webSpeechPonyfillFactory
          },
          document.getElementById('webchat')
        );
      }

      main().catch(err => console.error(err));
    </script>
  </body>
</html>
